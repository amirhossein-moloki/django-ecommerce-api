# مستند فنی پروژه فروشگاه اینترنتی مبتنی بر Django

این مستند به تشریح تحلیل فنی و امکانات پیاده‌سازی‌شده در پروژه بک‌اند فروشگاه اینترنتی می‌پردازد. هدف از این مستند، ارائه تصویری شفاف و دقیق از معماری، فناوری‌ها، قابلیت‌ها و خروجی‌های پروژه جهت استفاده در قراردادها و فرایندهای تحویل پروژه است.

---

### ۱. معرفی کلی پروژه

#### هدف پروژه
هدف اصلی این پروژه، توسعه و پیاده‌سازی یک زیرساخت بک‌اند (Backend) جامع و مقیاس‌پذیر برای یک فروشگاه اینترنتی مدرن است. این سیستم قادر است تمامی عملیات اصلی یک فروشگاه آنلاین، از مدیریت کاربران و محصولات گرفته تا پردازش سفارشات و پرداخت‌ها را مدیریت کند.

#### نوع سیستم
این پروژه یک سیستم **بک‌اند (Backend)** است که به‌صورت **API-محور (API-Driven)** طراحی شده است. تمام قابلیت‌های سیستم از طریق واسط‌های برنامه‌نویسی کاربردی (API) از نوع **RESTful** ارائه می‌شود که امکان اتصال و استفاده توسط انواع کلاینت‌ها (مانند وب‌سایت، اپلیکیشن موبایل و سایر سرویس‌ها) را فراهم می‌سازد.

---

### ۲. فناوری‌ها و ابزارهای استفاده‌شده

- **زبان برنامه‌نویسی:** Python 3.11
- **فریم‌ورک اصلی:** Django 5.2
- **فریم‌ورک API:** Django REST Framework (DRF) 3.16
- **پایگاه داده:** PostgreSQL 17 (از طریق Docker)
- **کش (Cache):** Redis 8.0 (برای کشینگ داده‌ها و صف پیام)
- **پردازش پس‌زمینه (Background Tasks):** Celery 5.5 (برای اجرای وظایف زمان‌بر مانند ارسال ایمیل)
- **ارتباطات آنی (Real-time):** Django Channels (برای قابلیت‌هایی مانند چت)
- **احراز هویت:**
  - JWT (JSON Web Token) با استفاده از `djangorestframework-simplejwt`
  - سیستم احراز هویت مبتنی بر OTP (رمز یک‌بار مصرف) پیامکی
  - پشتیبانی از ورود با حساب گوگل (Google OAuth2)
- **مستندسازی API:** `drf-spectacular` (برای تولید خودکار مستندات OpenAPI 3 و رابط کاربری Swagger)
- **تست:**
  - `pytest` و `pytest-django`
  - `factory-boy` (برای ساخت داده‌های آزمایشی)
- **کانتینرسازی و ارکستریشن:**
  - Docker و Docker Compose (برای توسعه و اجرای محلی)
  - Helm (برای پکیج‌بندی و استقرار بر روی Kubernetes)
- **وب‌سرور و پروکسی:** Nginx (به‌عنوان Reverse Proxy در محیط Docker)
- **ابزارهای جانبی:**
  - `django-environ`: مدیریت متغیرهای محیطی
  - `django-filter`: فیلترینگ پیشرفته در APIها
  - `django-taggit`: قابلیت برچسب‌گذاری محصولات
  - `Pillow`: پردازش تصاویر

---

### ۳. ماژول‌ها و قابلیت‌های پیاده‌سازی‌شده

#### مدیریت کاربران و احراز هویت (ماژول Account)
- ثبت‌نام و ورود کاربران از طریق شماره تلفن و رمز یک‌بار مصرف (OTP).
- سیستم احراز هویت امن مبتنی بر توکن‌های JWT (Access Token و Refresh Token).
- قابلیت تکمیل پروفایل کاربری پس از اولین ورود.
- مدیریت پروفایل شامل اطلاعات شخصی، تصویر پروفایل و آدرس‌ها.
- امکان افزودن و مدیریت چندین آدرس برای هر کاربر.
- سیستم مجوزدهی برای تفکیک دسترسی کاربران عادی، مدیران و کارمندان.
- امکان لاگ‌اوت و باطل کردن توکن‌ها برای افزایش امنیت.

#### مدیریت محصولات و دسته‌بندی‌ها (ماژول Shop)
- امکان تعریف و مدیریت دسته‌بندی‌های تو در تو برای محصولات.
- قابلیت افزودن، ویرایش و حذف محصولات با جزئیات کامل (نام، توضیحات، وزن، ابعاد و...).
- پشتیبانی از **محصولات متغیر (Variable Products)**؛ امکان تعریف ویژگی‌های مختلف (مانند رنگ و سایز) و قیمت و موجودی متفاوت برای هر متغیر.
- سیستم برچسب‌گذاری (Tagging) برای بهبود جستجو و دسته‌بندی.
- قابلیت ثبت نقد و بررسی (Review) و امتیازدهی (Rating) برای محصولات توسط خریداران.
- سیستم جستجوی پیشرفته و فیلترینگ محصولات بر اساس دسته‌بندی، برچسب، قیمت و...
- مدیریت موجودی انبار برای هر محصول یا متغیر آن.
- بارگذاری و مدیریت تصاویر محصولات.

#### سبد خرید (ماژول Cart)
- پیاده‌سازی سبد خرید پایدار برای کاربران احراز هویت‌شده (ذخیره در دیتابیس) و مهمان (ذخیره در Session).
- امکان افزودن، به‌روزرسانی تعداد و حذف محصولات از سبد خرید.
- محاسبه خودکار مبلغ کل سبد خرید.
- قابلیت پاک‌سازی کامل سبد خرید.
- کنترل موجودی انبار هنگام افزودن محصول به سبد.

#### سفارش‌ها و وضعیت سفارش (ماژول Orders)
- فرآیند ثبت سفارش از سبد خرید.
- مدیریت کامل چرخه‌ی حیات سفارش با وضعیت‌های مختلف (در انتظار پرداخت، پرداخت‌شده، در حال پردازش، ارسال‌شده، تحویل‌شده، لغو‌شده).
- پیاده‌سازی یک **State Machine** برای کنترل تغییر وضعیت سفارش و جلوگیری از انتقال‌های نامعتبر.
- ذخیره‌سازی تاریخچه سفارشات برای هر کاربر.
- قابلیت اعمال کوپن‌های تخفیف بر روی سفارش.
- محاسبه خودکار مبالغ نهایی سفارش شامل تخفیف، هزینه ارسال و مالیات.
- در صورت لغو سفارش، موجودی محصولات به‌صورت خودکار به انبار بازگردانده می‌شود.

#### پنل مدیریت (Admin)
- پنل مدیریت پیش‌فرض جنگو برای مدیریت تمامی مدل‌های داده (کاربران، محصولات، سفارشات و...).
- شخصی‌سازی پنل مدیریت برای نمایش بهینه اطلاعات و سهولت استفاده.

#### پرداخت (ماژول Payment)
- یکپارچه‌سازی با درگاه پرداخت آنلاین **زیبال**.
- فرآیند پرداخت شامل هدایت کاربر به درگاه، تایید پرداخت (Verify) و ثبت نتیجه.
- ثبت تمامی تراکنش‌های پرداخت با جزئیات کامل برای حسابرسی و پیگیری.
- طراحی ماژولار که امکان افزودن درگاه‌های پرداخت دیگر را در آینده فراهم می‌کند.

#### سایر قابلیت‌های پیاده‌سازی‌شده
- **کوپن‌های تخفیف (ماژول Coupons):** امکان تعریف کوپن‌های تخفیف با درصد مشخص و تاریخ انقضا.
- **ارسال پیامک (ماژول SMS):** یکپارچه‌سازی با سرویس SMS.ir برای ارسال رمزهای یک‌بار مصرف (OTP).
- **کشینگ (Caching):** استفاده از Redis برای کش کردن داده‌های پرتکرار (مانند لیست محصولات و دسته‌بندی‌ها) جهت افزایش چشمگیر سرعت پاسخ‌دهی API.

---

### ۴. APIها و خروجی‌های فنی

- **نوع APIها:** تمامی APIها بر اساس معماری **REST** طراحی شده‌اند و از متدهای استاندارد HTTP (GET, POST, PUT, PATCH, DELETE) استفاده می‌کنند.
- **ساختار پاسخ‌ها:** پاسخ‌های API دارای ساختار استاندارد و یکپارچه JSON هستند که شامل وضعیت موفقیت، پیام و داده‌های اصلی (`data`) می‌شود.
- **سطح دسترسی‌ها:** دسترسی به APIها بر اساس نقش کاربر (کاربر مهمان، کاربر احراز هویت‌شده، مدیر) کنترل می‌شود. به عنوان مثال، مشاهده محصولات برای همه آزاد است اما ثبت سفارش نیازمند احراز هویت است.
- **مستندسازی API:** مستندات کامل و تعاملی API به‌صورت خودکار با استفاده از `drf-spectacular` تولید شده و از طریق دو رابط کاربری **Swagger UI** و **ReDoc** در دسترس است. این مستندات شامل توضیحات کامل اندپوینت‌ها، پارامترهای ورودی، ساختار خروجی و نمونه درخواست‌ها می‌باشد.

---

### ۵. دیتابیس و ساختار داده

- **موجودیت‌های اصلی (Models):**
  - `UserAccount`: اطلاعات کاربران و پروفایل آن‌ها.
  - `Address`: آدرس‌های پستی کاربران.
  - `Category`: دسته‌بندی محصولات.
  - `Product`: اطلاعات پایه محصولات.
  - `ProductVariant`: متغیرهای محصول (مانند رنگ و سایز) با قیمت و موجودی مجزا.
  - `Review`: نقد و بررسی‌های کاربران برای محصولات.
  - `Cart` و `CartItem`: سبد خرید و آیتم‌های آن.
  - `Order` و `OrderItem`: سفارشات ثبت‌شده و جزئیات آن‌ها.
  - `PaymentTransaction`: لاگ تراکنش‌های پرداخت.
- **روابط بین آن‌ها:** روابط استاندارد پایگاه داده (One-to-One, One-to-Many, Many-to-Many) بین موجودیت‌ها برقرار است. به عنوان مثال، هر سفارش به یک کاربر و چندین آیتم سفارش تعلق دارد.
- **نکات مهم در طراحی:**
  - استفاده از UUID برای شناسه‌های اصلی برخی مدل‌ها (مانند `Product` و `Order`) برای جلوگیری از حدس زدن شناسه‌ها.
  - پیاده‌سازی Soft Delete برای محصولات جهت امکان بازیابی اطلاعات.
  - ایندکس‌گذاری مناسب بر روی فیلدهای پرکاربرد برای بهینه‌سازی سرعت کوئری‌ها.

---

### ۶. امنیت و کنترل دسترسی

- **احراز هویت:** از استاندارد **JWT** برای احراز هویت استفاده می‌شود. توکن‌ها دارای زمان انقضای محدود بوده و از Refresh Token برای تمدید نشست کاربر استفاده می‌گردد.
- **مجوزها (Permissions):** دسترسی به هر API بر اساس کلاس‌های مجوز سفارشی و پیش‌فرض DRF کنترل می‌شود. به عنوان مثال، تنها مالک یک سفارش یا مدیر سیستم می‌تواند آن را مشاهده کند.
- **نکات امنیتی رعایت‌شده:**
  - استفاده از ORM جنگو که از حملات SQL Injection جلوگیری می‌کند.
  - تنظیمات امنیتی استاندارد جنگو (مانند حفاظت در برابر CSRF و XSS) فعال است.
  - مدیریت متغیرهای حساس (مانند کلیدهای API و رمزها) از طریق متغیرهای محیطی (`.env`).
  - محدودسازی نرخ درخواست‌ها (Rate Limiting) برای جلوگیری از حملات Brute-force و DoS.
  - اجرای اپلیکیشن با کاربر غیر-root در داخل کانتینر داکر.

---

### ۷. تست، کیفیت و پایداری

- **تست‌های انجام‌شده:** پروژه دارای مجموعه کاملی از **تست‌های واحد (Unit Tests)** و **تست‌های یکپارچه‌سازی (Integration Tests)** با استفاده از فریم‌ورک `pytest` است. این تست‌ها منطق تجاری، مدل‌ها، سرویس‌ها و APIها را پوشش می‌دهند.
- **مدیریت خطاها:** یک سیستم مدیریت خطای مرکزی پیاده‌سازی شده که خطاهای پیش‌بینی‌نشده را ثبت کرده و پاسخ‌های استاندارد و امنی را به کلاینت بازمی‌گرداند تا از نشت اطلاعات حساس جلوگیری شود.
- **لاگ‌ها:** رویدادهای مهم سیستم، خطاها و درخواست‌های API در لاگ‌ها ثبت می‌شوند تا امکان نظارت و اشکال‌زدایی فراهم باشد.

---

### ۸. نحوه تحویل پروژه

- **روش تحویل سورس کد:** سورس کد کامل پروژه از طریق یک ریپازیتوری Git (مانند GitHub یا GitLab) تحویل داده خواهد شد.
- **مستندات تحویلی:**
  - همین مستند فنی.
  - مستندات آنلاین و تعاملی API (Swagger/ReDoc).
  - فایل `README.md` شامل راهنمای راه‌اندازی سریع پروژه.
- **راه‌اندازی و اجرای پروژه:** پروژه به‌صورت کامل **کانتینرسازی‌شده (Containerized)** با استفاده از Docker و Docker Compose ارائه می‌شود. فرآیند راه‌اندازی تنها به اجرای یک دستور (`docker-compose up`) محدود شده و تمامی سرویس‌ها (بک‌اند، دیتابیس، Redis و...) به‌صورت خودکار اجرا می‌شوند.

---

### ۹. موارد خارج از Scope پروژه

قابلیت‌های زیر به‌صورت آگاهانه در فاز فعلی پروژه پیاده‌سازی نشده‌اند اما زیرساخت لازم برای توسعه آن‌ها در آینده فراهم است:
- پنل کاربری فرانت‌اند (Front-End).
- سیستم‌های توصیه‌گر (Recommendation Engines) پیچیده.
- قابلیت‌های بازاریابی و SEO پیشرفته.
- انبارداری چندگانه.

---

### ۱۰. جمع‌بندی نهایی

- **نتیجه پروژه:** پروژه با موفقیت به یک زیرساخت بک‌اند قوی، امن و مقیاس‌پذیر برای یک فروشگاه اینترنتی دست یافته است. معماری ماژولار و API-محور آن، انعطاف‌پذیری بالایی را برای توسعه‌های آینده تضمین می‌کند.
- **آمادگی برای توسعه‌های آینده:** این سیستم به‌عنوان یک پایه محکم عمل کرده و آماده یکپارچه‌سازی با تیم‌های فرانت‌اند، توسعه اپلیکیشن‌های موبایل و افزودن ماژول‌های جدید در آینده می‌باشد.
