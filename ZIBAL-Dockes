درگاه پرداخت زیبال
مقدمه

به راهنمای سرویس درگاه پرداختی اینترنتی (IPG) زیبال خوش آمدید. این مستندات جهت آسانی استفاده شما از سرویس‌های زیبال جمع آوری شده‌اند. در صورت بروز هر گونه سوال با تیم فنی زیبال تماس بگیرید. وظیفه همکاران ما پاسخ به پیام‌های شما در اسرع وقت می‌باشد.

لطفا قبل از پیاده‌سازی به نکات زیر توجه نمایید:

API‌ های زیبال RESTful می‌باشند و درخواست‌ها و پاسخ‌ها به صورت JSON‌ رد و بدل می‌شوند.

زیبال تنها به درخواست‌هایی که تحت دامنه https ارسال می‌شوند پاسخ خواهد داد.

در صورت دریافت هر گونه خطا از جانب زیبال، پس از بررسی مقادیر ارسالی خود، این خطا را به همراه مقادیر ارسالی و مقادیر پاسخ‌ دریافتی را برای ما ارسال کنید.

یک حساب کاربری جهت تست تمام قابلیت‌ها و سرویس‌ها تهیه شده‌است. با قراردادن merchant : zibal می‌توانید از این حساب استفاده کنید.

مراحل راه‌اندازی

استفاده و راه‌اندازی سرویس درگاه پرداخت اینترنتی زیبال پیچیده نیست. تنها کافیست مراحل زیر را به‌درستی پیاده کنید:

درخواست پرداخت - Request
زیبال نیاز به اطلاعات سفارش شما دارد. در جواب این پایانه trackId را به‌عنوان شناسه پیگیری پرداخت دریافت خواهید کرد.

شروع پرداخت - Start
با ارسال trackId به این پایانه صفحه‌ی پرداخت نمایش داده می‌شود.

تایید پرداخت - Verify
زیبال وضعیت پرداخت را به callbackUrl ارسال می‌کند. سپس لازم است متد تایید تراکنش را فراخوانی کنید.

استعلام پرداخت - Inquiry
برای دریافت اطلاعات و وضعیت تراکنش در هر مرحله، از استعلام استفاده می‌شود.

با طی شدن این مسیر روند پرداخت یک سفارش پایان می‌یابد.

اعتبارسنجی

زیبال از پارامتر merchant جهت اعتبارسنجی درگاه‌های موجود استفاده می‌کند. این اطلاعات پس از ایجاد هر درگاه جدید در پنل کاربری زیبال موجود می‌باشند.

این امکان وجود دارد که درگاه خود را به IP (های) مشخصی محدود کنید.

حساب تستی

پیش از راه‌اندازی و فعال‌سازی درگاه شما می‌توانید با قراردادن merchant : zibal تمام امکانات و سرویس‌ها را آزمایش کنید.

تمامی درخواست‌های ارسالی به زیبال بایستی حاوی اطلاعات احراز هویت باشند:

{
  "merchant": "zibal"
  // OTHER FIELDS
}

درخواست پرداخت - Request

از این پایانه جهت ارسال اطلاعات سفارش و ثبت آن در سیستم زیبال استفاده کنید.

اطلاعات درخواست
https://gateway.zibal.ir/v1/request (POST)

بدنه درخواست

merchant (ضروری | String) : ضروری جهت احراز هویت

amount (ضروری | Long) : مبلغ کل سفارش (به ریال)

callbackUrl (ضروری | String) : آدرس پذیرنده برای دریافت اطلاعات پرداخت

description (اختیاری | String)

orderId (اختیاری | String)

mobile (اختیاری | String)

allowedCards (اختیاری | List[String])

nationalCode (اختیاری | String) : کد ملی ۱۰ رقمی

checkMobileWithCard (اختیاری | Boolean)

آیتم تسهیم (MultiplexingInfo)
تنها ارسال یکی از پارامترهای bankAccount یا subMerchantId در هر آیتم تسهیم اجباری است.

بدنه پاسخ

trackId : شناسه منحصربه‌فرد جلسه پرداخت

result : نتیجه درخواست (طبق جدول Result Code)

message : پیام نتیجه درخواست

جدول result

100: با موفقیت تایید شد.

102: merchant یافت نشد.

103: merchant غیرفعال / عدم امضا قرارداد درگاه مربوطه

104: merchant نامعتبر

105: amount بایستی بزرگتر از 1,000 ریال باشد.

106: callbackUrl نامعتبر می‌باشد. (شروع با http و یا https)

113: amount مبلغ تراکنش از سقف میزان تراکنش بیشتر است.

114: کدملی ارسالی نامعتبر است.

115: ip شما در پنل کاربری ثبت نشده است.

شروع به پرداخت - Start

از این پایانه جهت نمایان شدن صفحه‌ی پرداخت و شروع پرداخت استفاده کنید.

اطلاعات درخواست
https://gateway.zibal.ir/start/{{trackId}} (GET)

با ارسال trackId به آدرس بالا و باز کردن صفحه در مرورگر، به صفحه‌ی پرداخت درگاه مستقیم زیبال منتقل خواهید شد.

Callback

زیبال اطلاعات پرداخت یک سفارش را در زمان تغییر وضعیت به callbackUrl ثبت‌شده برای آن سفارش ارسال می‌کند.

این اطلاعات به صورت Query String و از طریق متد GET برای callbackUrl ارسال می‌شوند.

بدنه Callback

success : در صورت موفقیت 1 و در غیر این‌صورت 0

trackId : شناسه پیگیری جلسه پرداخت

orderId : شناسه سفارش (در صورت ارسال)

status : وضعیت پرداخت

مثال

https://yourcallbackurl.com/callback?trackId=9900&success=1&status=2&orderId=1

تایید پرداخت - Verify

از این پایانه جهت تایید موفقیت‌آمیز بودن پرداخت و پایان دادن به جلسه پرداخت استفاده نمایید.

اطلاعات درخواست
https://gateway.zibal.ir/v1/verify (POST)

بدنه درخواست

merchant (ضروری | String)

trackId (ضروری | Long)

بدنه پاسخ

paidAt : تاریخ پرداخت (ISODate)

cardNumber : شماره کارت Mask شده

status : وضعیت پرداخت

amount : مبلغ (ریال)

refNumber : شناسه مرجع تراکنش

description : توضیحات تراکنش

orderId : شناسه سفارش

result : نتیجه

message : پیام

جدول result

100: با موفقیت تایید شد.

102: merchant یافت نشد.

103: merchant غیرفعال

104: merchant نامعتبر

201: قبلا تایید شده

202: سفارش پرداخت نشده یا ناموفق بوده است.

203: trackId نامعتبر می‌باشد.

استعلام پرداخت - Inquiry

از این پایانه جهت استعلام پرداخت و دریافت گزارش یک جلسه پرداخت استفاده نمایید.

اطلاعات درخواست
https://gateway.zibal.ir/v1/inquiry (POST)

بدنه درخواست

merchant (ضروری | String)

trackId (ضروری | Long)

بدنه پاسخ

createdAt : تاریخ ایجاد سفارش (ISODate)

paidAt : تاریخ پرداخت (ISODate)

verifiedAt : تاریخ تایید (ISODate)

cardNumber : شماره کارت Mask شده

status : وضعیت پرداخت

amount : مبلغ (ریال)

refNumber : شناسه مرجع

description : توضیحات

orderId : شناسه سفارش

wage : نحوه کسر کارمزد

0 : کسر از تراکنش

1 : کسر از کیف پول کارمزد

result

message

جدول result

100: با موفقیت گزارش ایجاد شد.

102: merchant یافت نشد.

103: merchant غیرفعال

104: merchant نامعتبر

203: trackId نامعتبر می‌باشد.

متد وریفای سمت پذیرنده - متد Lazy

در صورت استفاده از متد وریفای سمت پذیرنده، اگر تا ۲۰ دقیقه پس از پرداخت، تاییدیه پرداخت ارسال نشود، مبلغ تراکنش به کارت پرداخت کننده بازگشت داده می‌شود. تفاوت این روش با روش عادی در پارامتر‌های ارسالی و دریافتی است.

شروع پرداخت - متد Lazy (Request)

اطلاعات درخواست
https://gateway.zibal.ir/request/lazy (POST)

بدنه درخواست

merchant (ضروری | String)

amount (ضروری | Long)

callbackUrl (ضروری | String)

description (اختیاری | String)

orderId (اختیاری | String)

mobile (اختیاری | String)

allowedCards (اختیاری | List[String]) : استفاده همزمان از lazy و allowedCards پیشنهاد نمی‌شود.

nationalCode (اختیاری | String)

checkMobileWithCard (اختیاری | Boolean)

آیتم تسهیم (MultiplexingInfo)
تنها ارسال یکی از پارامترهای bankAccount یا subMerchantId در هر آیتم تسهیم اجباری است.

بدنه پاسخ

trackId

result

message

جدول result

100: با موفقیت تایید شد.

102: merchant یافت نشد.

103: merchant غیرفعال / عدم امضا قرارداد درگاه مربوطه

104: merchant نامعتبر

105: amount بایستی بزرگتر از 1,000 ریال باشد.

106: callbackUrl نامعتبر می‌باشد. (شروع با http و یا https)

113: amount مبلغ تراکنش از سقف میزان تراکنش بیشتر است.

114: کدملی ارسالی نامعتبر است.

115: ip شما در پنل کاربری ثبت نشده است.

شروع به پرداخت - متد Lazy

ارجاع شود به شروع به پرداخت (روش عادی)

Callback - Lazy

در روش lazy اطلاعات به صورت JSON و از طریق متد POST برای callbackUrl ارسال می‌شوند.

بدنه Callback

success

trackId

orderId

status : تعیین وضعیت سفارش به عهده پذیرنده بوده و سفارش تا زمان تایید دارای وضعیت نیست.

cardNumber

hashedCardNumber

تایید تراکنش - متد Lazy (Verify)

اطلاعات درخواست
https://gateway.zibal.ir/verify (POST)

بدنه درخواست

merchant (ضروری | String)

trackId (ضروری | Long)

بدنه پاسخ

paidAt

cardNumber

status

amount

refNumber

description

orderId

result

message

جدول result

100: با موفقیت تایید شد.

102: merchant یافت نشد.

103: merchant غیرفعال

104: merchant نامعتبر

201: قبلا تایید شده

202: سفارش پرداخت نشده یا ناموفق بوده است.

203: trackId نامعتبر می‌باشد.

جدول وضعیت‌ها

-1 : در انتظار پرداخت

-2 : خطای داخلی

1 : پرداخت شده - تاییدشده

2 : پرداخت شده - تاییدنشده

3 : لغوشده توسط کاربر

4 : شماره کارت نامعتبر می‌باشد.

5 : موجودی حساب کافی نمی‌باشد.

6 : رمز واردشده اشتباه می‌باشد.

7 : تعداد درخواست‌ها بیش از حد مجاز می‌باشد.

8 : تعداد پرداخت اینترنتی روزانه بیش از حد مجاز می‌باشد.

9 : مبلغ پرداخت اینترنتی روزانه بیش از حد مجاز می‌باشد.

10 : صادرکننده‌ی کارت نامعتبر می‌باشد.

11 : خطای سوییچ

12 : کارت قابل دسترسی نمی‌باشد.

15 : تراکنش استرداد شده

16 : تراکنش در حال استرداد

18 : تراکنش ریورس شده

21 : پذیرنده نامعتبر است

نشان اعتماد زیبال

برای نمایش نشان اعتماد زیبال در وبسایت:

<script src="https://zibal.ir/trust/scripts/zibal-trust-v4.js" type="text/javascript"></script>


Dark Mode

<script src="https://zibal.ir/trust/scripts/zibal-trust-v4.js?theme=dark" type="text/javascript"></script>

نمونه تنظیم استایل/ابعاد
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <title>Document</title>
  <style>
    #zibal{ margin: auto; }
    #zibal img{ height: 200px!important; }
  </style>
</head>
<body>
  <div id='zibal'>
    <script src="https://zibal.ir/trust/scripts/zibal-trust-v4.js" type="text/javascript"></script>
  </div>
</body>
</html>

استفاده در Next.js
import Script from "next/script";

<div id='zibal'>
  <Script src="https://zibal.ir/trust/scripts/zibal-trust-v4.js" type="text/javascript"/>
</div>

اعلان تراکنش‌ها

برای اطلاع از تراکنش‌های موفقیت‌آمیز می‌توانید از ربات تلگرامی زیبال استفاده کنید (ZibalBot) و آن را به حساب کاربری خود متصل نمایید تا تمامی تراکنش‌ها در لحظه اطلاع‌رسانی شود.

نسخه

2.35.1
